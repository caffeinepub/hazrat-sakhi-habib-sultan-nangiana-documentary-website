{
  "kind": "build_request",
  "title": "Fix deployed site connection reset (remove next-themes + ensure production serves built Vite assets)",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-19",
      "text": "Remove the Next.js-only `next-themes` dependency and usage so the React (Vite) app boots without runtime crashes, while preserving the existing emerald/gold styling and any existing user-facing behavior.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10"
        ],
        "quotes": [
          "okay"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/src/App.tsx` no longer imports or uses `ThemeProvider` from `next-themes`.",
        "The app renders successfully in production without a blank page or runtime error related to theming.",
        "No user-facing text is changed as part of this fix (except any unavoidable error messages being removed by virtue of the crash being fixed)."
      ]
    },
    {
      "id": "REQ-20",
      "text": "Resolve the duplicated React Query setup by ensuring there is exactly one `QueryClientProvider` at runtime, without editing any immutable frontend paths.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10"
        ],
        "quotes": [
          "okay"
        ]
      },
      "acceptanceCriteria": [
        "The app uses a single `QueryClientProvider` (no nested/duplicated providers).",
        "The change does not require editing `frontend/src/main.tsx` (immutable).",
        "React Query continues to function for visitor message submission (no runtime errors, mutation still works)."
      ]
    },
    {
      "id": "REQ-21",
      "text": "Fix production deployment so the Internet Computer serves the built Vite frontend output (compiled JS/CSS assets) rather than attempting to load TypeScript source from `/src/main.tsx`, eliminating the browser “connection reset”/unreachable behavior.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-10"
        ],
        "quotes": [
          "okay"
        ]
      },
      "acceptanceCriteria": [
        "The deployed site opens successfully in a browser (no “connection reset”, no blank page).",
        "The production `index.html` served by the canister references built asset files (e.g., `/assets/...js`) rather than `/src/main.tsx`.",
        "A fresh load (hard refresh) works and all sections (Hero, Documentary, Timeline, Reflection, Legacy, Story, Gallery, Contact) render."
      ]
    }
  ],
  "constraints": [
    "Do not edit immutable frontend paths: `frontend/src/main.tsx`, `frontend/src/hooks/useInternetIdentity.ts(x)`, `frontend/src/hooks/useActor.ts`, and anything under `frontend/src/components/ui`.",
    "Backend must remain a single Motoko actor in `backend/main.mo`; only add `backend/migration.mo` if existing stable state requires migration."
  ],
  "nonGoals": [
    "Adding new product features or new sections to the site.",
    "Implementing third-party auth providers (only Internet Identity is allowed).",
    "Changing the documentary content, SEO copy, or overall site theme beyond what is necessary to fix the crash and deployment issue."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}